# 입금 처리 관련 API (구현 필요)

## 개요

이 문서는 EzPG 전자결제 시스템의 입금 처리 관련 API 중 현재 구현이 필요한 API들을 설명합니다. 이 API들은 은행-VAN(더즌)-기관 간의 실제 입금 처리 흐름에 필요합니다.

## API 목록

| 순번 | API 명           | 설명                     | 문서 위치                   | 구현 상태 |
| ---- | ---------------- | ------------------------ | --------------------------- | --------- |
| 1    | 수취조회 API     | 입금 전 계좌 유효성 확인 | etc/api-processing-guide.md | 구현 필요 |
| 2    | 입금사전조회 API | 입금 전 사전 확인        | etc/api-processing-guide.md | 구현 필요 |
| 3    | 입금 API         | 입금 처리                | etc/api-processing-guide.md | 구현 필요 |
| 4    | 입금정정 API     | 입금 취소/정정 처리      | etc/api-processing-guide.md | 구현 필요 |
| 5    | 집계 API         | 거래 집계 정보           | etc/api-processing-guide.md | 구현 필요 |

## API 상세 정보

### 1. 수취조회 API

#### 기능 설명

- 은행에서 고객이 입금하기 전 예금주명 및 입금 가능상태에 대하여 조회하는 전문입니다.
- 기관에서 입금가능 여부를 판단하여 응답 처리합니다.
- 수취조회 전문은 은행에서 고객이 해당계좌의 정당성여부를 판단하기 위하여 발생하는 전문이며, 해당계좌의 입금하려는 정보가 정당한 경우 응답코드 정상과 예금주명을 SET하여 전송합니다.
- 제휴기관에서 정상응답을 송신하여도 반드시 입금전문이 발생하는 것은 아닌 조회성 전문입니다.

#### 요청 정보

- URL: `/api/deposit/account-validation`
- Method: POST
- Content-Type: application/json

#### 요청 파라미터

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0500",
  "tr_dsc": "4100",
  "tr_dt": "20230312",
  "tr_tm": "150256",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "I",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": ""
}
```

#### 응답 정보

```json
{
  "tr_dt": "20230312",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "rv_acno": "56211024649265",
  "tram": 300,
  "rsp_c": "0000",
  "rv_dprnm": "홍길동",
  "org_c": "35000099"
}
```

### 2. 입금사전조회 API

#### 기능 설명

- 입금요청 발생시 전문이 발생하며 해당전문에 제휴기관이 정상 응답하는 경우 입금전문이 발생합니다.
- 불능 또는 무응답(10초)인 경우 더즌은 은행으로 불능으로 응답하며 입금처리가 되지 않습니다.
- 입금이 통보전문으로 발생하는 은행인 경우, 입금사전조회는 발생하지 않습니다.

#### 요청 정보

- URL: `/api/deposit/pre-validation`
- Method: POST
- Content-Type: application/json

#### 요청 파라미터

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0200",
  "tr_dsc": "1100",
  "tr_dt": "20230312",
  "tr_tm": "150256",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "I",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": ""
}
```

#### 응답 정보

```json
{
  "tr_dt": "20230312",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "rv_acno": "56211024649265",
  "tram": 300,
  "rsp_c": "0000",
  "rv_dprnm": "홍길동",
  "org_c": "35000099"
}
```

### 3. 입금 API

#### 기능 설명

- 입금전문은 통보성 전문이며 이미 입금이 완료된 상태로 제휴기관으로부터 정상응답이 수신될 때까지 10분마다 재전송합니다.
- 입금전문의 거래번호는 입금사전조회의 거래번호와 동일합니다.
- 입금 거래는 입금사전 거래전문의 I/R(INTERACTIVE) 기준으로 입금하며 입금전문은 통보전문으로 구성합니다.
- 실입금자명 사용 기관의 경우, 실입금자명 처리 이후에 입금전문을 발송합니다.

#### 요청 정보

- URL: `/api/deposit/process`
- Method: POST
- Content-Type: application/json

#### 요청 파라미터

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0200",
  "tr_dsc": "1000",
  "tr_dt": "20230312",
  "tr_tm": "150256",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "S",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": "",
  "real_dprnm_yn": "Y",
  "real_dprnm": "이명규"
}
```

#### 응답 정보

```json
{
  "tr_dt": "20230312",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "rv_acno": "56211024649265",
  "tram": 300,
  "rsp_c": "0000",
  "rv_dprnm": "홍길동",
  "org_c": "35000099"
}
```

### 4. 입금정정 API

#### 기능 설명

- 입금정정은 입금전문과 거래번호가 동일하게 전송되며 해당거래번호에 대하여 정상응답이 오는 경우 거래에 대해 정정이 처리됩니다.
- 일부 은행에 한하여 은행 시스템오류로 정정 완료 후 통보성으로 전송되어 수신합니다.

#### 요청 정보

- URL: `/api/deposit/correction`
- Method: POST
- Content-Type: application/json

#### 요청 파라미터

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0400",
  "tr_dsc": "1000",
  "tr_dt": "20230312",
  "tr_tm": "150256",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "S",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": ""
}
```

#### 응답 정보

```json
{
  "tr_dt": "20230312",
  "tr_natv_no": "03120000000074",
  "bnk_c": "088",
  "rv_acno": "56211024649265",
  "tram": 300,
  "rsp_c": "0000",
  "rv_dprnm": "홍길동",
  "org_c": "35000099"
}
```

### 5. 집계 API

#### 기능 설명

- 집계 API는 더즌과 은행간 집계내역을 기관으로 전송하며 응답시 기관이 집계된 거래내역을 더즌으로 SET하여 리턴합니다.
- 집계API는 대사를 맞추기 위한 정보이며 응답을 필수적으로 처리합니다.
- 집계API는 더즌에서 발생하며 입금 및 취소에 대한 건수/금액을 확인하여 전송합니다.

#### 요청 정보

- URL: `/api/deposit/aggregation`
- Method: POST
- Content-Type: application/json

#### 요청 파라미터

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0500",
  "tr_dsc": "7000",
  "tr_dt": "20230312",
  "tr_tm": "165539",
  "tr_natv_no": "93122200000018",
  "tot_dt": "20230312",
  "dz_rv_nrm_cn": 1,
  "dz_rv_nrm_am": 3000000,
  "dz_rv_crc_cn": 1,
  "dz_rv_crc_am": 100
}
```

#### 응답 정보

```json
{
  "rsp_c": "0000",
  "tot_dt": "20230312",
  "rv_nrm_cn": 1000,
  "rv_nrm_am": 10000,
  "rv_crc_cn": 10,
  "rv_crc_am": 5100,
  "org_c": "30000003"
}
```

## 구현 시 주의사항

### 1. 입금사전거래 전문의 TIMEOUT 처리

- 입금사전거래 전문의 TIMEOUT 시간은 10초이며 무응답시 은행으로 오류를 더즌에서 응답 처리하며 입금은 처리되지 않습니다.

### 2. 입금 API 재전송 처리

- 입금API는 통보성으로 전송하며, 입금API에 대하여 무응답시 10분 주기로 더즌에서 기관으로 재전송합니다.

### 3. 실입금자명 처리

- 실입금자명 사용 기관의 경우, 실입금자명 처리 이후에 입금전문을 발송합니다.
- 실입금자명 처리까지 최대 3분 대기 후, 미처리 시 실입금자명 미처리로 입금전문 발송합니다.
- 거래 당일에 실입금자명 처리가 되지 않을 경우, 익일 00시경 실입금자명 미처리로 입금전문을 발송합니다.
- 실입금자명 사용을 원하는 기관의 경우, 은행과 실입금자 계약이 진행되어야 합니다. (보험사만 가능)

### 4. 가상계좌입금처리 업무시간

- 은행별로 업무처리시간은 다르며 일반적으로 00:30 ~ 23:30 거래가 가능합니다.
- 은행은 정기적으로 점검일자를 가지며 해당일자의 거래 개시기간이 늦어질 수 있습니다.
