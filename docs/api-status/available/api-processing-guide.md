# EzPG API 처리 기준 문서

## 목차

1. [API 처리 기준](#1-api-처리-기준)
2. [은행-VAN(더즌)-기관 구성도](#2-은행-van더즌-기관-구성도)
3. [API 구성정보](#3-api-구성정보)
4. [API 목록 및 정의](#4-api-목록-및-정의)
5. [매체코드](#5-매체코드)

## 1. API 처리 기준

### 수취조회 API

1. 수취조회 API는 은행에서 고객이 입금하기 전 예금주명 및 입금 가능상태에 대하여 조회하는 전문이며, 기관에서 입금가능 여부를 판단하여 응답 처리한다.

### 입금 API

1. 입금 거래는 입금사전 거래전문의 I/R(INTERACTIVE) 기준으로 입금하며 입금전문은 통보전문으로 구성한다.
2. 입금사전거래 전문의 TIMEOUT 시간은 10초이며 무응답시 은행으로 오류를 더즌에서 응답 처리하며 입금은 처리되지 않는다.
3. 입금API는 통보성으로 전송하며, 입금API에 대하여 무응답시 10분 주기로 더즌에서 기관으로 재전송한다.
4. 실입금자명 사용 기관의 경우, 실입금자명 처리 이후에 입금전문을 발송한다. (실입금자명 처리까지 최대 3분 대기 후, 미처리 시 실입금자명 미처리로 입금전문 발송)
5. 거래 당일에 실입금자명 처리가 되지 않을 경우, 익일 00시경 실입금자명 미처리로 입금전문을 발송한다.
6. 실입금자명 사용을 원하는 기관의 경우, 은행과 실입금자 계약이 진행되어야 한다. (보험사만 가능)

### 집계 API

1. 집계API는 더즌에서 발생하며 입금 및 취소에 대한 건수/금액을 확인하여 전송한다.

### 가상계좌입금처리 업무시간

1. 은행별로 업무처리시간은 다르며 일반적으로 00:30 ~ 23:30 거래가 가능하다.
2. 은행은 정기적으로 점검일자를 가지며 해당일자의 거래 개시기간이 늦어질 수 있다.

## 2. 은행-VAN(더즌)-기관 구성도

### 네트워크 구성도

은행 → 더즌(VAN) → 기관

## 3. API 구성정보

### API 소개

1. HTTPS-POST를 기반한다.
2. 가상계좌 서비스에 대한 규격을 정의한다.

### API 호출방식

| NO  | 구분                     | 내용             |
| --- | ------------------------ | ---------------- |
| 1   | PROTOCOL                 | HTTPS            |
| 2   | 요청 HEADER CONTENT_TYPE | Application/json |
| 3   | 요청 METHOD              | POST             |
| 4   | 기본 CHARACTER SET       | UTF-8            |
| 5   | 데이터 형태              | JSON             |

해당 API는 기관의 실시간 거래처리를 위하여 더즌이 CLIENT, 기관이 SERVER 모델이다. \*기관은 API를 처리할 페이지를 더즌에 제공하여야 하며 API별 또는 동일페이지 모두 가능하다.

## 4. API 목록 및 정의

### 전문 업무 구분 종류

| 업무구분     | 전문구분 (tgrm_dsc) | 거래구분코드(tr_dsc) | 전문발생 | 비고       |
| ------------ | ------------------- | -------------------- | -------- | ---------- |
| 입금         | 0200                | 1000                 | 은행     | 통보성전문 |
| 입금정정     | 0400                | 1000                 | 은행     |            |
| 입금사전조회 | 0200                | 1100                 | 은행     |            |
| 입금수취조회 | 0500                | 4100                 | 은행     |            |
| 집계         | 0500                | 7000                 | 더즌     |            |

### 1. 입금 / 입금사전조회 / 수취조회 / 입금정정

#### 1.1 요청(application/json)

| NO  | 항목         | 파라미터      | 데이터타입 | 필수 | 최대길이 | 비고                                                                                                             |
| --- | ------------ | ------------- | ---------- | ---- | -------- | ---------------------------------------------------------------------------------------------------------------- |
| 1   | 시스템 ID    | sysid         | String     | ○    | 3        | "VAS"                                                                                                            |
| 2   | 기관코드     | org_c         | String     | ○    | 8        | 계약 기관코드                                                                                                    |
| 3   | 전문구분코드 | tgrm_dsc      | String     | ○    | 4        | 전문 업무 구분 종류 참조                                                                                         |
| 4   | 거래구분코드 | tr_dsc        | String     | ○    | 4        | 전문 업무 구분 종류 참조                                                                                         |
| 5   | 거래일자     | tr_dt         | String     |      | 8        | YYYYMMDD                                                                                                         |
| 6   | 거래시간     | tr_tm         | String     |      | 6        | HHMMSS                                                                                                           |
| 7   | 거래고유번호 | tr_natv_no    | String     | ○    | 14       | 거래고유번호                                                                                                     |
| 8   | 은행코드     | bnk_c         | String     | ○    | 3        |                                                                                                                  |
| 9   | 취급지로코드 | giro_c        | String     |      | 7        |                                                                                                                  |
| 10  | 발생구분     | ocu_dsc       | String     | ○    | 1        | B:은행, D:더즌                                                                                                   |
| 11  | 입금처리구분 | ir_saf_dsc    | String     | ○    | 1        | 통보성 전문:S, IR 전문:I                                                                                         |
| 12  | 매체구분     | med_dsc       | String     |      | 2        | 세부정보 참조                                                                                                    |
| 13  | 마감구분     | ddl_dsc       | String     |      | 1        | 은행기준 마감구분 0:마감전, 1:마감후                                                                             |
| 14  | 입금은행코드 | rv_bnk_c      | String     | ○    | 3        |                                                                                                                  |
| 15  | 입금계좌번호 | rv_acno       | String     | ○    | 16       |                                                                                                                  |
| 16  | 출금은행코드 | drw_bnk_c     | String     |      | 3        |                                                                                                                  |
| 17  | 출금계좌성명 | drw_dprnm     | String     |      | 30       |                                                                                                                  |
| 18  | 거래금액     | tram          | Number     | ○    | 13       |                                                                                                                  |
| 19  | 수표금액     | obc_tram      | Number     | ○    | 13       | 입금금액내 수표금액                                                                                              |
| 20  | 현금금액     | csh_tram      | Number     | ○    | 13       | 입금금액내 현금금액                                                                                              |
| 21  | 재전송여부   | retry_yn      | String     |      | 1        | 'Y': 재처리전문                                                                                                  |
| 22  | 자동취소여부 | aut_crc_yn    | String     |      | 1        | 'Y': 자동 취소인 경우 SET 함                                                                                     |
| 23  | 실입금자여부 | real_dprnm_yn | String     | ○    | 1        | 실입금자전문 사용기관일 경우만 사용<br>Y: 실입금자명전문이 들어온 경우<br>N: 실입금자명전문이 들어오지 않은 경우 |
| 24  | 실입금자명   | real_dprnm    | String     | ○    | 20       | 실입금자전문 사용기관일 경우만 사용<br>은행에서 공백으로 들어올 가능성 존재<br>실입금자여부로 확인 가능          |

#### 1.2 Request Body 예시

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0500",
  "tr_dsc": "4100",
  "tr_dt": "20200407",
  "tr_tm": "150256",
  "tr_natv_no": "04070000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "I",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": ""
}
```

실입금자명 사용 예시:

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0500",
  "tr_dsc": "4100",
  "tr_dt": "20200407",
  "tr_tm": "150256",
  "tr_natv_no": "04070000000074",
  "bnk_c": "088",
  "giro_c": "",
  "ocu_dsc": "B",
  "ir_saf_dsc": "I",
  "med_dsc": "01",
  "ddl_dsc": "0",
  "rv_bnk_c": "088",
  "rv_acno": "56211024649265",
  "drw_bnk_c": "",
  "drw_dprnm": "은행테스트",
  "tram": 300,
  "obc_tram": 0,
  "csh_tram": 300,
  "retry_yn": "",
  "aut_crc_yn": "",
  "real_dprnm_yn": "Y",
  "real_dprnm": "이명규"
}
```

#### 1.3 응답(application/json) - Status code:200 / 200 외 오류처리

| NO  | 항목         | 파라미터   | 데이터타입 | 필수 | 최대길이 | 비고                            |
| --- | ------------ | ---------- | ---------- | ---- | -------- | ------------------------------- |
| 1   | 거래일자     | tr_dt      | String     | ○    | 8        | YYYYMMDD                        |
| 2   | 거래고유번호 | tr_natv_no | String     | ○    | 14       | 거래고유번호                    |
| 3   | 은행코드     | bnk_c      | String     | ○    | 3        |                                 |
| 4   | 입금계좌번호 | rv_acno    | String     | ○    | 16       |                                 |
| 5   | 거래금액     | tram       | Number     | ○    | 13       |                                 |
| 6   | 응답코드     | rsp_c      | String     | ○    | 4        | "0000"외 오류 – 응답코드표 참조 |
| 7   | 입금예금주명 | rv_dprnm   | String     | ○    | 20       |                                 |
| 8   | 기관코드     | org_c      | String     | ○    | 8        |                                 |

#### 1.4 Response Body 예시

```json
{
  "tr_dt": "20200407",
  "tr_natv_no": "04070000000074",
  "bnk_c": "088",
  "rv_acno": "56211024649265",
  "tram": 300,
  "rsp_c": "0000",
  "rv_dprnm": "홍길동",
  "org_c": "35000099"
}
```

#### 1.5 API 설명

##### 1) 수취조회 (0500/4100)

- 수취조회 전문은 은행에서 고객이 해당계좌의 정당성여부를 판단하기 위하여 발생하는 전문이며 해당계좌의 입금하려는 정보가 정당한 경우 응답코드 정상과 예금주명을 SET하여 전송한다.
- 제휴기관에서 정상응답을 송신하여도 반드시 입금전문이 발생하는 것은 아닌 조회성 전문이다.

##### 2) 입금사전조회 (0200/1100)

- 입금요청 발생시 전문이 발생하며 해당전문에 제휴기관이 정상 응답하는 경우 입금전문이 발생하며 불능 또는 무응답(10초)인 경우 더즌은 은행으로 불능으로 응답하며 입금처리가 되지 않는다.
- 입금이 통보전문으로 발생하는 은행인 경우, 입금사전조회는 발생하지 않는다.

##### 3) 입금 (0200/1000)

- 입금전문은 통보성 전문이며 이미 입금이 완료된 상태로 제휴기관으로부터 정상응답이 수신될 때까지 10분마다 재전송한다.
- 입금전문의 거래번호는 입금사전조회의 거래번호와 동일하다.

##### 4) 입금정정 (0400/1000)

- 입금정정은 입금전문과 거래번호가 동일하게 전송되며 해당거래번호에 대하여 정상응답이 오는 경우 거래에 대해 정정이 처리되나 일부 은행에 한하여 은행 시스템오류로 정정 완료 후 통보성으로 전송되어 수신한다.

### 2. 집계

#### 2.1 요청(application/json)

| NO  | 항목             | 파라미터     | 데이터타입 | 필수 | 최대길이 | 비고                     |
| --- | ---------------- | ------------ | ---------- | ---- | -------- | ------------------------ |
| 1   | 시스템 ID        | sysid        | String     | ○    | 3        | "VAS"                    |
| 2   | 기관코드         | org_c        | String     | ○    | 8        | 계약 기관코드            |
| 3   | 전문구분코드     | tgrm_dsc     | String     | ○    | 4        | 전문 업무 구분 종류 참조 |
| 4   | 거래구분코드     | tr_dsc       | String     | ○    | 4        | 전문 업무 구분 종류 참조 |
| 5   | 거래일자         | tr_dt        | String     |      | 8        | YYYYMMDD                 |
| 6   | 거래시간         | tr_tm        | String     |      | 6        | HHMMSS                   |
| 7   | 거래고유번호     | tr_natv_no   | String     | ○    | 14       | 거래고유번호             |
| 8   | 집계일자         | tot_dt       | String     | ○    | 8        |                          |
| 9   | 더즌입금정상건수 | dz_rv_nrm_cn | Number     | ○    | 7        |                          |
| 10  | 더즌입금정상금액 | dz_rv_nrm_am | Number     | ○    | 13       |                          |
| 11  | 더즌입금취소건수 | dz_rv_crc_cn | Number     | ○    | 7        |                          |
| 12  | 더즌입금취소금액 | dz_rv_crc_am | Number     | ○    | 13       |                          |

#### 2.2 Request Body 예시

```json
{
  "sysid": "VAS",
  "org_c": "30000003",
  "tgrm_dsc": "0500",
  "tr_dsc": "7000",
  "tr_dt": "20200407",
  "tr_tm": "165539",
  "tr_natv_no": "93122200000018",
  "tot_dt": "20200407",
  "dz_rv_nrm_cn": 1,
  "dz_rv_nrm_am": 3000000,
  "dz_rv_crc_cn": 1,
  "dz_rv_crc_am": 100
}
```

#### 2.3 응답(application/json) - Status code:200 / 200 외 오류처리

| NO  | 항목         | 파라미터  | 데이터타입 | 필수 | 최대길이 | 비고                 |
| --- | ------------ | --------- | ---------- | ---- | -------- | -------------------- |
| 1   | 응답코드     | rsp_c     | String     | ○    | 4        | 응답코드 참조        |
| 2   | 집계일자     | tot_dt    | String     | ○    | 8        |                      |
| 3   | 입금정상건수 | rv_nrm_cn | Number     | ○    | 7        | 기관의 집계 정상건수 |
| 4   | 입금정상금액 | rv_nrm_am | Number     | ○    | 13       | 기관의 집계 정상금액 |
| 5   | 입금취소건수 | rv_crc_cn | Number     | ○    | 7        | 기관의 집계 취소건수 |
| 6   | 입금취소금액 | rv_crc_am | Number     | ○    | 13       | 기관의 집계 취소금액 |
| 7   | 기관코드     | org_c     | String     | ○    | 8        |                      |

#### 2.4 Response Body 예시

```json
{
  "rsp_c": "0000",
  "tot_dt": "20200407",
  "rv_nrm_cn": 1000,
  "rv_nrm_am": 10000,
  "rv_crc_cn": 10,
  "rv_crc_am": 5100,
  "org_c": "30000003"
}
```

#### 2.5 API 설명

##### 1) 집계 (0500/7000)

- 집계 API는 더즌과 은행간 집계내역을 기관으로 전송하며 응답시 기관이 집계된 거래내역을 더즌으로 SET하여 리턴한다.
- 집계API는 대사를 맞추기 위한 정보이며 응답을 필수적으로 처리한다.

## 5. 매체코드

| 구분 | 유형       | 구분 | 유형       | 구분 | 유형     | 구분 | 유형    | 구분 | 유형           |
| ---- | ---------- | ---- | ---------- | ---- | -------- | ---- | ------- | ---- | -------------- |
| 01   | 창구       | 02   | 인터넷뱅킹 | 03   | 텔레뱅킹 | 04   | 타행 CD | 05   | 당행 CD        |
| 06   | ATM 현금   | 07   | 제휴 CD    | 08   | 자동이체 | 09   | 타행환  | 10   | 전자금융공동망 |
| 11   | 실시간이체 | 99   | 기타       | 13   | 국고망   | 14   | 제휴 CD | 15   | R&D            |
